"use strict";(self.webpackChunkMetaWall=self.webpackChunkMetaWall||[]).push([[132],{4132:(E,P,o)=>{o.r(P),o.d(P,{AddPostModule:()=>B});var c=o(9808),l=o(2382),m=o(1442),h=o(1810),t=o(1223),v=o(9166),A=o(6705),C=o(72),g=o(5826),_=o(9527);function d(e,u){1&e&&t._UZ(0,"span",18)}function r(e,u){if(1&e){const n=t.EpF();t.TgZ(0,"button",19),t.NdJ("click",function(){return t.CHM(n),t.oxw().delImage()}),t._uU(1,"\u522a\u9664\u5716\u7247"),t.qZA()}}function i(e,u){if(1&e&&t._UZ(0,"img",20),2&e){const n=t.oxw();t.Q6J("src",n.post.image,t.LSH)}}function p(e,u){if(1&e&&(t.TgZ(0,"li"),t._uU(1),t.qZA()),2&e){const n=u.$implicit;t.xp6(1),t.Oqu(n)}}let b;const M=[{path:"",component:(()=>{class e{constructor(n,s,a,f,O){this.router=n,this.postService=s,this.uploadService=a,this.spinner=f,this.swalDefaultService=O,this.post={content:"",image:""},this.uploadErrs=[],this.isUploading=!1,this.spinner.hide(),b=this.swalDefaultService.toastDefault}ngOnInit(){}upload(n){if(this.uploadErrs.length=0,1===n.target.files.length){const s=n.target.files[0];-1===s.name.search(/\.(jpg|png)$/i)&&this.uploadErrs.push("\u5716\u7247\u683c\u5f0f\u932f\u8aa4\uff0c\u50c5\u9650 JPG\u3001PNG \u5716\u7247"),s.size/1024/1024>2&&this.uploadErrs.push("\u5716\u7247\u6a94\u6848\u904e\u5927\uff0c\u50c5\u9650 2mb \u4ee5\u4e0b\u6a94\u6848"),this.uploadErrs.length||(this.isUploading=!0,this.uploadService.upload(s).subscribe(a=>{a.success?this.post.image=a.data:this.uploadErrs.push(a.message),this.isUploading=!1}))}}delImage(){this.uploadErrs.length=0,this.post.image=""}trackByFn(n,s){return s}addPost(){this.spinner.show(),this.postService.addPost(this.post).subscribe(n=>{this.spinner.hide(),n&&b.fire({icon:n.success?"success":"error",title:"\u65b0\u589e\u8cbc\u6587"+(n.success?"\u6210\u529f":"\u5931\u6557")}).then(s=>{n.success&&this.router.navigate(["/index"])})})}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(h.F0),t.Y36(v.L),t.Y36(A.C),t.Y36(C.t2),t.Y36(g.K))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-add-post"]],decls:21,vars:13,consts:[[3,"title"],[3,"ngSubmit"],["validateForm","ngForm"],[1,"card","mt-4"],[1,"card-body","p-6"],["for","postContent",1,"form-label"],["id","postContent","rows","5","placeholder","\u8f38\u5165\u60a8\u7684\u8cbc\u6587\u5167\u5bb9","name","content","required","",1,"form-control",3,"ngModel","ngModelChange"],["content","ngModel"],[1,"d-flex","justify-content-between","align-items-center"],[1,"btn","btn-dark","btn-sm","px-6","my-4","d-flex","align-items-center"],["type","file","accept",".jpg, .png","name","file",1,"d-none",3,"change"],["class","spinner-border spinner-border-sm ms-1","role","status","aria-hidden","true",4,"ngIf"],["type","button","class","btn btn-link btn-sm fs-8",3,"click",4,"ngIf"],["class","img-fluid d-block border rounded","alt","\u8cbc\u6587\u5716\u7247",3,"src",4,"ngIf"],[1,"list-unstyled","mb-0","mt-3","invalid-feedback","text-center"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"d-grid","gap-2","col-md-9","mx-auto","mt-4",3,"ngClass"],["type","submit",1,"btn","btn-primary",3,"disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","ms-1"],["type","button",1,"btn","btn-link","btn-sm","fs-8",3,"click"],["alt","\u8cbc\u6587\u5716\u7247",1,"img-fluid","d-block","border","rounded",3,"src"]],template:function(n,s){if(1&n&&(t._UZ(0,"app-title",0),t.TgZ(1,"form",1,2),t.NdJ("ngSubmit",function(){return s.addPost()}),t.TgZ(3,"div",3)(4,"div",4)(5,"label",5),t._uU(6,"\u8cbc\u6587\u5167\u5bb9*"),t.qZA(),t.TgZ(7,"textarea",6,7),t.NdJ("ngModelChange",function(f){return s.post.content=f}),t.qZA(),t.TgZ(9,"div",8)(10,"label",9)(11,"input",10),t.NdJ("change",function(f){return s.upload(f)}),t.qZA(),t._uU(12,"\u4e0a\u50b3\u5716\u7247"),t.YNc(13,d,1,0,"span",11),t.qZA(),t.YNc(14,r,2,0,"button",12),t.qZA(),t.YNc(15,i,1,1,"img",13),t.TgZ(16,"ul",14),t.YNc(17,p,2,1,"li",15),t.qZA(),t.TgZ(18,"div",16)(19,"button",17),t._uU(20,"\u9001\u51fa\u8cbc\u6587"),t.qZA()()()()()),2&n){const a=t.MAs(2);t.Q6J("title","\u5f35\u8cbc\u52d5\u614b"),t.xp6(7),t.Q6J("ngModel",s.post.content),t.xp6(3),t.ekj("disabled",s.isUploading),t.xp6(3),t.Q6J("ngIf",s.isUploading),t.xp6(1),t.Q6J("ngIf",s.post.image),t.xp6(1),t.Q6J("ngIf",s.post.image),t.xp6(1),t.ekj("d-block",s.uploadErrs.length),t.xp6(1),t.Q6J("ngForOf",s.uploadErrs)("ngForTrackBy",s.trackByFn),t.xp6(1),t.Q6J("ngClass",a.invalid||s.uploadErrs.length?"mt-4":"mt-6"),t.xp6(1),t.Q6J("disabled",a.invalid||s.uploadErrs.length||s.isUploading)}},directives:[_.r,l._Y,l.JL,l.F,l.Fj,l.Q7,l.JJ,l.On,c.O5,c.sg,c.mk],styles:[""]}),e})()}];let T=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[h.Bz.forChild(M)],h.Bz]}),e})(),B=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[c.ez,l.u5,T,m.i]]}),e})()},9166:(E,P,o)=>{o.d(P,{L:()=>C});var c=o(4004),l=o(262),m=o(9646),h=o(5136),t=o(1223),v=o(520),A=o(72);let C=(()=>{class g extends h.b{constructor(d,r){super(r),this.http=d,this.spinner=r}getPosts(d){let r="";for(const i in d)d[i]&&(r+=r?"&":"?",r+=`${i}=${d[i]}`);return this.http.get(this.API_ROOT+"posts"+r,this.getHeader()).pipe((0,c.U)(i=>this.covertReturn(i)),(0,l.K)(i=>(this.covertReturn(i.error),(0,m.of)(!1))))}getUserPosts(d,r){let i="";for(const p in r)r[p]&&(i+=i?"&":"?",i+=`${p}=${r[p]}`);return this.http.get(this.API_ROOT+"posts/"+d+i,this.getHeader()).pipe((0,c.U)(p=>this.covertReturn(p)),(0,l.K)(p=>(this.covertReturn(p.error),(0,m.of)(!1))))}addPost(d){return this.http.post(this.API_ROOT+"posts",d,this.getHeader()).pipe((0,c.U)(r=>r),(0,l.K)(r=>(0,m.of)(this.covertReturn(r.error))))}}return g.\u0275fac=function(d){return new(d||g)(t.LFG(v.eN),t.LFG(A.t2))},g.\u0275prov=t.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()}}]);