"use strict";(self.webpackChunkMetaWall=self.webpackChunkMetaWall||[]).push([[132],{4132:(b,A,d)=>{d.r(A),d.d(A,{AddPostModule:()=>U});var u=d(9808),a=d(2382),h=d(1442),m=d(1810),f=d(5826),t=d(1223),v=d(9166),C=d(6705),g=d(72),_=d(9527);function n(o,c){1&o&&t._UZ(0,"span",18)}function e(o,c){if(1&o){const s=t.EpF();t.TgZ(0,"button",19),t.NdJ("click",function(){return t.CHM(s),t.oxw().delImage()}),t._uU(1,"\u522a\u9664\u5716\u7247"),t.qZA()}}function i(o,c){if(1&o&&t._UZ(0,"img",20),2&o){const s=t.oxw();t.Q6J("src",s.post.image,t.LSH)}}function p(o,c){if(1&o&&(t.TgZ(0,"li"),t._uU(1),t.qZA()),2&o){const s=c.$implicit;t.xp6(1),t.Oqu(s)}}function E(o,c){1&o&&t._UZ(0,"span",18)}let O,T;const I=[{path:"",component:(()=>{class o{constructor(s,r,l,P,M,y){this.router=s,this.route=r,this.postService=l,this.uploadService=P,this.spinner=M,this.swalDefaultService=y,this.post={content:"",image:""},this.uploadErrs=[],this.isUploading=!1,this.isAddPostSpinner=!1,O=f.K.prototype.popupDefault,T=this.swalDefaultService.toastDefault}ngOnInit(){this.postID=this.route.snapshot.paramMap.get("id"),this.title=(this.postID?"\u7de8\u8f2f":"\u5f35\u8cbc")+"\u52d5\u614b",this.postID?this.postService.getPost(this.postID).subscribe(s=>{this.spinner.hide(),s?(this.post.content=s.content,this.post.image=s.image):O.fire({title:"\u7cfb\u7d71\u8a0a\u606f",text:"\u627e\u4e0d\u5230\u6b64\u8cbc\u6587",icon:"error",showCloseButton:!1,showConfirmButton:!1}).then(r=>{window.history.back()})}):this.spinner.hide()}upload(s){if(this.uploadErrs.length=0,1===s.target.files.length){const r=s.target.files[0];-1===r.name.search(/\.(jpg|png)$/i)&&this.uploadErrs.push("\u5716\u7247\u683c\u5f0f\u932f\u8aa4\uff0c\u50c5\u9650 JPG\u3001PNG \u5716\u7247"),r.size/1024/1024>2&&this.uploadErrs.push("\u5716\u7247\u6a94\u6848\u904e\u5927\uff0c\u50c5\u9650 2mb \u4ee5\u4e0b\u6a94\u6848"),this.uploadErrs.length||(this.isUploading=!0,this.uploadService.upload(r).subscribe(l=>{l.success?this.post.image=l.data:this.uploadErrs.push(l.message),this.isUploading=!1}))}}delImage(){this.uploadErrs.length=0,this.post.image=""}trackByFn(s,r){return r}addOrEditPost(){this.isAddPostSpinner=!0,this.postID?this.postService.editPost(this.postID,this.post).subscribe(s=>{s&&this.setSwalToast(s.success,"\u7de8\u8f2f\u8cbc\u6587")}):this.postService.addPost(this.post).subscribe(s=>{s&&this.setSwalToast(s.success,"\u65b0\u589e\u8cbc\u6587")})}setSwalToast(s,r){T.fire({icon:s?"success":"error",title:`${r}${s?"\u6210\u529f":"\u5931\u6557"}`}).then(l=>{this.isAddPostSpinner=!1,s&&this.router.navigate(["/index"])})}}return o.\u0275fac=function(s){return new(s||o)(t.Y36(m.F0),t.Y36(m.gz),t.Y36(v.L),t.Y36(C.C),t.Y36(g.t2),t.Y36(f.K))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-add-post"]],decls:22,vars:14,consts:[[3,"title"],[3,"ngSubmit"],["validateForm","ngForm"],[1,"card","mt-4"],[1,"card-body","p-6"],["for","postContent",1,"form-label"],["id","postContent","rows","5","placeholder","\u8f38\u5165\u60a8\u7684\u8cbc\u6587\u5167\u5bb9","name","content","required","",1,"form-control",3,"ngModel","ngModelChange"],["content","ngModel"],[1,"d-flex","justify-content-between","align-items-center"],[1,"btn","btn-dark","btn-sm","px-6","my-4","d-flex","align-items-center"],["type","file","accept",".jpg, .png","name","file",1,"d-none",3,"change"],["class","spinner-border spinner-border-sm ms-1","role","status","aria-hidden","true",4,"ngIf"],["type","button","class","btn btn-link btn-sm fs-8",3,"click",4,"ngIf"],["class","img-fluid d-block border rounded","alt","\u8cbc\u6587\u5716\u7247",3,"src",4,"ngIf"],[1,"list-unstyled","mb-0","mt-3","invalid-feedback","text-center"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"d-grid","gap-2","col-md-9","mx-auto","mt-4",3,"ngClass"],["type","submit",1,"btn","btn-primary",3,"disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","ms-1"],["type","button",1,"btn","btn-link","btn-sm","fs-8",3,"click"],["alt","\u8cbc\u6587\u5716\u7247",1,"img-fluid","d-block","border","rounded",3,"src"]],template:function(s,r){if(1&s&&(t._UZ(0,"app-title",0),t.TgZ(1,"form",1,2),t.NdJ("ngSubmit",function(){return r.addOrEditPost()}),t.TgZ(3,"div",3)(4,"div",4)(5,"label",5),t._uU(6,"\u8cbc\u6587\u5167\u5bb9*"),t.qZA(),t.TgZ(7,"textarea",6,7),t.NdJ("ngModelChange",function(P){return r.post.content=P}),t.qZA(),t.TgZ(9,"div",8)(10,"label",9)(11,"input",10),t.NdJ("change",function(P){return r.upload(P)}),t.qZA(),t._uU(12,"\u4e0a\u50b3\u5716\u7247"),t.YNc(13,n,1,0,"span",11),t.qZA(),t.YNc(14,e,2,0,"button",12),t.qZA(),t.YNc(15,i,1,1,"img",13),t.TgZ(16,"ul",14),t.YNc(17,p,2,1,"li",15),t.qZA(),t.TgZ(18,"div",16)(19,"button",17),t._uU(20,"\u9001\u51fa\u8cbc\u6587"),t.YNc(21,E,1,0,"span",11),t.qZA()()()()()),2&s){const l=t.MAs(2);t.Q6J("title",r.title),t.xp6(7),t.Q6J("ngModel",r.post.content),t.xp6(3),t.ekj("disabled",r.isUploading),t.xp6(3),t.Q6J("ngIf",r.isUploading),t.xp6(1),t.Q6J("ngIf",r.post.image),t.xp6(1),t.Q6J("ngIf",r.post.image),t.xp6(1),t.ekj("d-block",r.uploadErrs.length),t.xp6(1),t.Q6J("ngForOf",r.uploadErrs)("ngForTrackBy",r.trackByFn),t.xp6(1),t.Q6J("ngClass",l.invalid||r.uploadErrs.length?"mt-4":"mt-6"),t.xp6(1),t.Q6J("disabled",l.invalid||r.uploadErrs.length||r.isUploading||r.isAddPostSpinner),t.xp6(2),t.Q6J("ngIf",r.isAddPostSpinner)}},directives:[_.r,a._Y,a.JL,a.F,a.Fj,a.Q7,a.JJ,a.On,u.O5,u.sg,u.mk],styles:[""]}),o})()}];let R=(()=>{class o{}return o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[m.Bz.forChild(I)],m.Bz]}),o})(),U=(()=>{class o{}return o.\u0275fac=function(s){return new(s||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[u.ez,a.u5,R,h.i]]}),o})()},9166:(b,A,d)=>{d.d(A,{L:()=>C});var u=d(4004),a=d(262),h=d(9646),m=d(5136),f=d(1223),t=d(520),v=d(72);let C=(()=>{class g extends m.b{constructor(n,e){super(e),this.http=n,this.spinner=e}getPosts(n){let e="";for(const i in n)n[i]&&(e+=e?"&":"?",e+=`${i}=${n[i]}`);return this.http.get(this.API_ROOT+"posts"+e,this.getHeader()).pipe((0,u.U)(i=>this.covertReturn(i)),(0,a.K)(i=>(this.covertReturn(i.error),(0,h.of)(!1))))}getPost(n,e){let i="";for(const p in e)e[p]&&(i+=i?"&":"?",i+=`${p}=${e[p]}`);return this.http.get(`${this.API_ROOT}posts/${n}${i}`,this.getHeader()).pipe((0,u.U)(p=>this.covertReturn(p)),(0,a.K)(p=>(this.covertReturn(p.error),(0,h.of)(!1))))}addPost(n){return this.http.post(this.API_ROOT+"posts",n,this.getHeader()).pipe((0,u.U)(e=>e),(0,a.K)(e=>(0,h.of)(this.covertReturn(e.error))))}addPostLike(n){return this.http.post(`${this.API_ROOT}posts/${n}/like`,"",this.getHeader()).pipe((0,u.U)(e=>e),(0,a.K)(e=>(0,h.of)(this.covertReturn(e.error))))}postUnlike(n){return this.http.delete(`${this.API_ROOT}posts/${n}/unlike`,this.getHeader()).pipe((0,u.U)(e=>e),(0,a.K)(e=>(0,h.of)(this.covertReturn(e.error))))}addPostComment(n,e){return this.http.post(`${this.API_ROOT}posts/${n}/comment`,{comment:e},this.getHeader()).pipe((0,u.U)(i=>this.covertReturn(i)),(0,a.K)(i=>(0,h.of)(this.covertReturn(i.error))))}getUserPosts(n,e){let i="";for(const p in e)e[p]&&(i+=i?"&":"?",i+=`${p}=${e[p]}`);return this.http.get(this.API_ROOT+"posts/user/"+n+i,this.getHeader()).pipe((0,u.U)(p=>this.covertReturn(p)),(0,a.K)(p=>(this.covertReturn(p.error),(0,h.of)(!1))))}delPosts(){return this.http.delete(`${this.API_ROOT}posts`,this.getHeader()).pipe((0,u.U)(n=>n),(0,a.K)(n=>(0,h.of)(this.covertReturn(n.error))))}delPost(n){return this.http.delete(`${this.API_ROOT}posts/${n}`,this.getHeader()).pipe((0,u.U)(e=>e),(0,a.K)(e=>(0,h.of)(this.covertReturn(e.error))))}editPost(n,e){return this.http.patch(`${this.API_ROOT}posts/${n}`,e,this.getHeader()).pipe((0,u.U)(i=>i),(0,a.K)(i=>(0,h.of)(this.covertReturn(i.error))))}}return g.\u0275fac=function(n){return new(n||g)(f.LFG(t.eN),f.LFG(v.t2))},g.\u0275prov=f.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()}}]);